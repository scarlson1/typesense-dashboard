const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/JsonEditor-Bq7nYOz8.js","assets/index-Dl23e-b0.js","assets/index-Dr0eHeR0.css"])))=>i.map(i=>d[i]);
import{bk as z,j as e,u as Y,m as J,r as t,n as D,q as U,ac as V,bl as R,a as P,t as k,B as j,T as d,L as E,O as _,bm as $,P as W,aU as F,aW as q,S as M,bn as T,bo as N,bp as L,bq as h,br as A,Z as w,a9 as X,bs as H,a5 as Q,aS as G}from"./index-Dl23e-b0.js";import{u as Z}from"./useSchema-CiM71O5J.js";const ee=z(e.jsx("path",{d:"M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59 7.11 5.7a.996.996 0 0 0-1.41 0c-.39.39-.39 1.02 0 1.41L10.59 12 5.7 16.89c-.39.39-.39 1.02 0 1.41s1.02.39 1.41 0L12 13.41l4.89 4.89c.39.39 1.02.39 1.41 0s.39-1.02 0-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4"})),se=s=>{const a=Y(),[x,p]=J(),[r,i]=t.useState([]),n=t.useCallback(()=>{i([])},[]);return[D({mutationFn:async({collectionId:o,documents:l,options:m})=>(await x.collections(o).documents().import(l,m)).split(`
`).map(f=>JSON.parse(f)),onMutate:o=>{a.loading("importing documents...",{id:"import-docs"})},onSuccess:(o,l,m)=>{console.log("lines: ",o),i(o);const y=o.reduce((g,b)=>g+b.success*1,0),f=o.reduce((g,b)=>g+!b.success*1,0);a[f?"warn":"success"](`import complete [success: ${y}; failed: ${f}]`,{id:"import-docs"})},onError:(o,l,m)=>{a.error("importing documents...",{id:"import-docs"})},onSettled:(o,l,m,y)=>{U.invalidateQueries({queryKey:V.documents(p,m.collectionId)})}}),r,n]},te=t.lazy(()=>X(()=>import("./JsonEditor-Bq7nYOz8.js"),__vite__mapDeps([0,1,2])));function re(){const s=R.useParams({select:({collectionId:c})=>c}),a=Y(),x=t.useRef(null),[p,r]=t.useState("create"),[i,n]=t.useState(),[u,o]=t.useState([]),{data:l}=Z(s),m=t.useMemo(()=>{let c=l==null?void 0:l.fields.reduce((S,v)=>{let I=le(v.type);return I?{...S,[v.name]:I}:S},{});return JSON.stringify([c],null,2)},[l==null?void 0:l.fields]),[y,f,C]=se(),g=t.useCallback(c=>{r(c.target.value)},[]),b=t.useCallback(c=>{n(c.target.value)},[]),K=t.useCallback(c=>{x.current=c},[]),B=t.useCallback(()=>{var v;const c=(v=x.current)==null?void 0:v.getValue();if(u.length)return a.warn("Invalid JSON",{id:"monaco-validation"});if(!c)return a.warn("value required");let S=oe(JSON.parse(c));y.mutate({collectionId:s,documents:S,options:{action:p,dirty_values:i,return_id:!0}})},[s,u,p,i]);return e.jsxs(j,{sx:{py:2,borderRadius:1,overflow:"hidden"},children:[e.jsx(t.Suspense,{fallback:e.jsx(q,{variant:"rounded",height:"50vh"}),children:e.jsx(te,{height:"50vh",onMount:K,options:F,value:m,onValidate:c=>{o(c)}})}),e.jsxs(M,{direction:"row",spacing:2,sx:{my:2,display:"flex",alignItems:"flex-start",flexWrap:"wrap"},useFlexGap:!0,children:[e.jsxs(T,{size:"small",fullWidth:!0,sx:{maxWidth:190},children:[e.jsx(N,{id:"action-select-label",children:"Action Mode"}),e.jsxs(L,{label:"Action Mode",value:p,onChange:g,labelId:"action-select-label",id:"action-select",size:"small",children:[e.jsx(h,{value:"create",children:"create"}),e.jsx(h,{value:"upsert",children:"upsert"}),e.jsx(h,{value:"update",children:"update"}),e.jsx(h,{value:"emplace",children:"emplace"})]}),e.jsx(A,{component:"div",children:e.jsxs(E,{href:"https://typesense.org/docs/28.0/api/documents.html#index-multiple-documents",target:"_blank",rel:"noopener noreferrer",children:["Action mode insert docs"," ",e.jsx(_,{fontSize:"inherit",sx:{ml:.25}})]})})]}),e.jsxs(T,{size:"small",fullWidth:!0,sx:{maxWidth:190},children:[e.jsx(N,{id:"dirty-values-select-label",children:"Dirty Values Behavior"}),e.jsxs(L,{label:"Dirty Values Behavior",value:i||"",onChange:b,labelId:"dirty-values-select-label",id:"dirty-values-select",size:"small",children:[e.jsx(h,{value:""}),e.jsx(h,{value:"coerce_or_reject",children:"coerce_or_reject"}),e.jsx(h,{value:"coerce_or_drop",children:"coerce_or_drop"}),e.jsx(h,{value:"drop",children:"drop"}),e.jsx(h,{value:"reject",children:"reject"})]}),e.jsx(A,{component:"div",children:e.jsxs(E,{href:"https://typesense.org/docs/28.0/api/documents.html#dealing-with-dirty-data",target:"_blank",rel:"noopener noreferrer",children:["Dirty values docs"," ",e.jsx(_,{fontSize:"inherit",sx:{ml:.25}})]})})]}),e.jsx(w,{onClick:()=>B(),disabled:!!u.length,variant:"contained",children:"Add"})]}),e.jsx(ne,{results:f,clearResults:C})]})}function ne({results:s,clearResults:a}){const[x,p]=t.useState(!0),r=t.useCallback(()=>{p(n=>!n)},[]),i=t.useCallback(()=>{a()},[]);return e.jsxs(e.Fragment,{children:[s.length?e.jsxs(M,{direction:"row",spacing:2,sx:{justifyContent:"space-between",alignItems:"center",py:1},children:[e.jsx(w,{size:"small",onClick:r,endIcon:x?e.jsx(H,{fontSize:"small"}):e.jsx(Q,{fontSize:"small"}),children:x?"hide results":"show results"}),e.jsx(w,{size:"small",onClick:i,sx:{mb:1},endIcon:e.jsx(ee,{fontSize:"small"}),children:"Clear results"})]}):null,e.jsx(G,{in:x&&!!(s!=null&&s.length),children:s.map(n=>e.jsx($,{severity:n.success?"success":"error",sx:{maxWidth:760,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:`[ID: ${n.id}] - ${n.error||`import success: ${n.success}`}`},n.id))})]})}function oe(s){return s.map(a=>JSON.stringify(a)).join(`
`)}function le(s){switch(s){case"auto":return null;case"bool":return!1;case"bool[]":return[!0,!1];case"float":return 3.14159;case"float[]":return[3.12159];case"geopoint":return[34.0549,118.2426];case"geopoint[]":return[[34.0549,118.2426],[35.4792,117.2389]];case"geopolygon":return[34.0549,35.4792,118.2426,117.2389];case"image":return"base64 encoded string of an image";case"int32":return 0;case"int32[]":return[0,1];case"int64":return 0;case"int64[]":return[0,1];case"object":return{key:"value"};case"object[]":return[{key:"value"}];case"string":return"string value";case"string*":return"string or string[]";case"string[]":return["string value"];default:return null}}function O({children:s}){return e.jsx(W,{sx:{p:{xs:1.5,sm:2},my:2},children:e.jsx(d,{variant:"body2",color:"textSecondary",component:"pre",sx:{wordWrap:"break-word",overflowWrap:"break-word",wordBreak:"keep-all",whiteSpace:"pre-wrap"},children:s})})}const ae=function(){const{collectionId:a}=R.useParams(),x=P(k,l=>l.credentials),p=P(k,l=>l.currentCredsKey);let r=p?x[p]:null,i=(r==null?void 0:r.protocol)||"[PROTOCOL]",n=(r==null?void 0:r.node)||"[YOUR_NODE]",u=i==="http"?(r==null?void 0:r.port)||"[PORT]":"",o=a||"[COLLECTION_NAME]";return e.jsxs(e.Fragment,{children:[e.jsxs(j,{sx:{py:2},children:[e.jsx(d,{variant:"h3",gutterBottom:!0,children:"Add Documents"}),e.jsx(d,{variant:"h6",color:"primary",gutterBottom:!0,children:"Option 1: Typesense client libraries"}),e.jsxs(d,{component:"div",children:["Use one of Typesense's client libraries to import data into your collection."," ",e.jsxs(E,{href:"https://typesense.org/docs/29.0/api/documents.html#index-a-single-document",target:"_blank",rel:"noopener noreferrer",children:["Read the documentation"," ",e.jsx(_,{fontSize:"inherit",sx:{ml:.25}})]})," ","for more information. Here are some"," ",e.jsxs(E,{href:"https://typesense.org/docs/guide/syncing-data-into-typesense.html#tips-when-importing-data",target:"_blank",rel:"noopener noreferrer",children:["tips ",e.jsx(_,{fontSize:"inherit",sx:{ml:.25}})]})," ","from Typesense to successfully import large volumes of data."]})]}),e.jsxs(j,{sx:{py:2},children:[e.jsx(d,{variant:"h6",color:"primary",gutterBottom:!0,children:"Option 2: Upload a JSONL file via curl"}),e.jsx(d,{children:"Create a file named documents.jsonl with your documents and then run the following commands in your terminal:"}),e.jsxs(O,{children:[e.jsx("code",{children:"export TYPESENSE_API_KEY=YOUR_API_KEY"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("code",{children:'curl -H "X-TYPESENSE-API-KEY: ${TYPESENSE_API_KEY}" \\'}),e.jsx("br",{}),e.jsx("code",{style:{paddingLeft:"24px"},children:"-X POST \\"}),e.jsx("br",{}),e.jsx("code",{style:{paddingLeft:"24px"},children:"-T documents.jsonl \\"}),e.jsx("br",{}),e.jsx("code",{style:{paddingLeft:"24px"},children:`"${i}://${n}${u?`:${u}`:""}/collections/${o}/documents/import?action=create"`})]})]}),e.jsxs(j,{sx:{py:2},children:[e.jsx(d,{variant:"h6",color:"primary",gutterBottom:!0,children:"Option 3: Upload a JSON file"}),e.jsx(d,{children:"Create a file named documents.json with your documents as a JSON array and then run the following commands in your terminal:"}),e.jsxs(O,{children:[e.jsx("code",{children:"# Convert from JSON to JSONL before importing."}),e.jsx("br",{}),e.jsx("code",{children:"# Make sure you have `jq` installed."}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("code",{children:"jq -c '.[]' documents.json > documents.jsonl"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("code",{children:"export TYPESENSE_API_KEY=YOUR_API_KEY"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("code",{children:'curl -H "X-TYPESENSE-API-KEY: ${TYPESENSE_API_KEY}" \\'}),e.jsx("br",{}),e.jsx("code",{style:{paddingLeft:"24px"},children:"-X POST \\"}),e.jsx("br",{}),e.jsx("code",{style:{paddingLeft:"24px"},children:"-T documents.jsonl \\"}),e.jsx("br",{}),e.jsx("code",{style:{paddingLeft:"24px"},children:`"${i}://${n}${u?`:${u}`:""}/collections/${o}/documents/import?action=create"`})]})]}),e.jsxs(j,{sx:{py:2},children:[e.jsx(d,{variant:"h6",color:"primary",gutterBottom:!0,children:"Option 4: Upload a CSV file"}),e.jsx(d,{children:"Create a file named documents.csv with your documents (including a header row) and run the following commands in your terminal"}),e.jsxs(O,{children:[e.jsx("code",{children:"# Convert from JSON to JSONL before importing."}),e.jsx("br",{}),e.jsx("code",{children:"# Make sure you have miller installed: https://github.com/johnkerl/miller"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("code",{children:"mlr --icsv --ojsonl cat documents.csv > documents.jsonl"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("code",{children:"export TYPESENSE_API_KEY=YOUR_API_KEY"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("code",{children:'curl -H "X-TYPESENSE-API-KEY: ${TYPESENSE_API_KEY}" \\'}),e.jsx("br",{}),e.jsx("code",{style:{paddingLeft:"24px"},children:"-X POST \\"}),e.jsx("br",{}),e.jsx("code",{style:{paddingLeft:"24px"},children:"-T documents.jsonl \\"}),e.jsx("br",{}),e.jsx("code",{style:{paddingLeft:"24px"},children:`"${i}://${n}${u?`:${u}`:""}/collections/${o}/documents/import?action=create"`})]})]}),e.jsxs(j,{sx:{py:2},children:[e.jsx(d,{variant:"h6",color:"primary",gutterBottom:!0,children:"Option 5: Use the document editor below"}),e.jsx(d,{children:"Edit the template documents below and click on Add at the bottom of the editor."}),e.jsx($,{severity:"warning",sx:{my:1,maxWidth:1e3},children:'The prefilled schema is derived from the collection schema. Expect imperfections, especially for nested fields and "auto" schemas.'}),e.jsx(j,{children:e.jsx(re,{})})]})]})};export{ae as component};
