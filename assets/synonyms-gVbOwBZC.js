import{m as v,u as A,v as W,ac as x,n as w,q as c,a8 as S,r as z,j as e,G,w as Q,x as T,T as b,B as _,y as q,aI as K,aJ as L,aK as R,_ as d,aL as g,aM as C,L as M,O as N,P,b as k}from"./index-Dl23e-b0.js";const B=({collectionId:s})=>{const[t,a]=v(),r=A(),{data:f,isFetching:u,isLoading:o,isError:y,error:m}=W({queryKey:x.synonyms(a,s),queryFn:async()=>(await t.collections(s).synonyms().retrieve()).synonyms}),h=w({mutationFn:n=>t.collections(s).synonyms(n).delete(),onMutate:async n=>{await c.cancelQueries({queryKey:x.synonyms(a,s)});const i=c.getQueryData(x.synonyms(a,s)),l=i==null?void 0:i.find(p=>p.id===n);return c.setQueryData(x.synonyms(a,s),p=>p.filter(j=>j.id!==n)),r.loading(`deleting synonym [${n}]...`,{id:"delete-synonym"}),{id:n,prevData:l}},onSuccess:(n,i,l)=>{r.success(`API synonym deleted [${l.id}]`,{id:"delete-synonym"})},onError:(n,i,l)=>{let p=n.message||"failed to delete synonym";r.error(p,{id:"delete-synonym"}),l!=null&&l.prevData&&c.setQueryData(S.all(a),j=>({keys:[...j.keys||[],l.prevData]}))},onSettled:()=>{c.invalidateQueries({queryKey:S.all(a)})}}),D=z.useMemo(()=>[{field:"id",headerName:"ID",type:"string",minWidth:120,flex:.8,sortable:!1,filterable:!1},{field:"synonyms",headerName:"Synonyms",type:"string",minWidth:120,flex:.8,sortable:!1,filterable:!1,valueGetter:(n,i)=>i.synonyms?i.synonyms.join(", "):""},{field:"root",headerName:"Root",type:"string",minWidth:100,flex:1,valueGetter:(n,i)=>i.root??""},{field:"symbols_to_index",headerName:"Symbols to Index",type:"string",minWidth:100,flex:1,sortable:!1,filterable:!1,valueGetter:(n,i)=>i.symbols_to_index?i.symbols_to_index.join(", "):""},{field:"locale",headerName:"Locale",type:"string",minWidth:100,flex:1,valueGetter:(n,i)=>i.locale??""},{field:"grid-actions",type:"actions",headerName:"Actions",minWidth:60,maxWidth:80,flex:1,getActions:n=>[e.jsx(G,{icon:e.jsx(Q,{placement:"top",title:"delete",children:e.jsx(T,{fontSize:"small"})}),onClick:async()=>{h.mutate(n.row.id)},label:"Delete Synonyms",disabled:h.isPending})]}],[h.isPending,h.mutate]);return y?e.jsx(b,{children:m.message||"something went wrong"}):e.jsx(_,{sx:{display:"flex",flexDirection:"column",minHeight:267,maxHeight:{xs:"calc(100vh - 140px)",md:"calc(100vh - 160px)"},width:"100%"},children:e.jsx(q,{rows:f||[],columns:D,loading:o||u,pageSizeOptions:[5,10,20],initialState:{columns:{columnVisibilityModel:{}},pagination:{paginationModel:{pageSize:10,page:0}}}})})},E=R({synonyms:g(),root:g(),symbols_to_index:g(),locale:g()}),F=K({defaultValues:{synonyms:"",root:"",symbols_to_index:"",locale:""},validators:{onChange:E}}),I=L({...F,render:({form:s})=>e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{size:{xs:12,sm:6},children:e.jsx(s.AppField,{name:"synonyms",children:({TextField:t})=>e.jsx(t,{id:"synonyms",label:"Synonyms",required:!0,fullWidth:!0,variant:"outlined",helperText:"Separate words by commas"})})}),e.jsx(d,{size:{xs:12,sm:6},children:e.jsx(s.AppField,{name:"root",children:({TextField:t})=>e.jsx(t,{id:"root",label:"Root",fullWidth:!0,variant:"outlined",helperText:"Leave empty to create a multi-way synonym"})})}),e.jsx(d,{size:{xs:12,sm:6},children:e.jsx(s.AppField,{name:"symbols_to_index",children:({TextField:t})=>e.jsx(t,{id:"symbols_to_index",label:"Symbols to Index",fullWidth:!0,variant:"outlined",placeholder:"e.g. +,-,_",helperText:"Separate symbols by commas"})})}),e.jsx(d,{size:{xs:12,sm:6},children:e.jsx(s.AppField,{name:"locale",children:({TextField:t})=>e.jsx(t,{id:"locale",label:"Locale",fullWidth:!0,variant:"outlined",placeholder:"e.g. en or jp",helperText:"Leave blank to auto-detect"})})}),e.jsx(d,{size:{xs:12},children:e.jsx(s.AppForm,{children:e.jsx(s.SubmitButton,{label:"Add"})})})]})});function O({collectionId:s}){const[t,a]=v(),r=A(),f=w({mutationFn:({synonymId:o,params:y})=>t.collections(s).synonyms().upsert(o,y),onMutate:()=>{r.loading("saving synonyms",{id:"synonyms"})},onSuccess:()=>{r.success("synonyms saved",{id:"synonyms"})},onError:o=>{let y=(o==null?void 0:o.message)??"An error occurred saving synonyms";r.error(y,{id:"synonyms"})},onSettled:()=>{c.invalidateQueries({queryKey:x.synonyms(a,s)})}}),u=k({...F,onSubmit:async({value:o})=>{let y={...o,synonyms:o.synonyms.split(",").map(m=>m.trim()),symbols_to_index:o.symbols_to_index.split(",").map(m=>m.trim())};try{await f.mutateAsync({synonymId:o.synonyms,params:y}),u.reset()}catch{}}});return e.jsx(_,{component:"form",onSubmit:o=>{o.preventDefault(),o.stopPropagation(),u.handleSubmit()},noValidate:!0,sx:{display:"flex",flexDirection:"column",width:"100%",gap:2},children:e.jsx(I,{form:u})})}const H=function(){const{collectionId:t}=C.useParams();return e.jsxs(e.Fragment,{children:[e.jsx(b,{variant:"h3",gutterBottom:!0,children:"Synonyms"}),e.jsxs(b,{gutterBottom:!0,children:[e.jsxs(M,{href:"",target:"_blank",rel:"noopener noreferrer",children:["Read the documentation",e.jsx(N,{fontSize:"inherit",sx:{ml:.25}})]})," ","for information on one-way vs multi-way synonyms."]}),e.jsx(P,{sx:{mt:2,p:{xs:1.5,sm:2,md:2.5}},children:e.jsx(O,{collectionId:t})}),e.jsx(_,{sx:{py:2},children:e.jsx(B,{collectionId:t})})]})};export{H as component};
