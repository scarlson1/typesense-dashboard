import{u as g,m as y,W as f,af as u,n as x,q as m,r as j,j as a,G as A,w,x as b,B as p,y as C,T as h,L as E,O as D,P as F,E as R,ac as q,b as Q,ag as k,ah as _}from"./index-CEjZvgK9.js";import{E as v}from"./ErrorFallback-DA_GSf9C.js";function I(){const o=g(),[c,i]=y(),{data:r}=f({queryKey:u.all(i),queryFn:async()=>(await c.aliases().retrieve()).aliases||[]}),l=x({mutationFn:e=>c.aliases(e).delete(),onMutate:e=>{o.loading(`deleting alias "${e}"`,{id:"delete-alias"});const s=m.getQueryData(u.all(i));return m.setQueryData(u.all(i),t=>t.filter(d=>d.name!==e)),{name:e,prevAliases:s}},onSuccess:(e,s,t)=>{o.success(`alias "${t.name}" deleted`,{id:"delete-alias"})},onError(e,s,t){console.log("ERROR: ",e);let d=e.message??`failed to delete alias "${t==null?void 0:t.name}"`;o.error(d,{id:"delete-alias"}),m.setQueryData(u.all(i),t==null?void 0:t.prevAliases)},onSettled:()=>{m.invalidateQueries({queryKey:u.all(i)})}}),n=j.useMemo(()=>[{field:"name",headerName:"Alias",type:"string",minWidth:100,flex:1,sortable:!1,filterable:!1},{field:"collection_name",headerName:"Target Collection",type:"string",minWidth:100,flex:1,sortable:!0,filterable:!0},{headerName:"Actions",field:"actions",type:"actions",width:80,getActions:e=>[a.jsx(A,{icon:a.jsx(w,{placement:"top",title:"Delete",children:a.jsx(b,{fontSize:"small"})}),onClick:()=>{l.mutate(e.row.name)},label:"Delete Alias",disabled:!e.row.name||l.isPending})]}],[]);return a.jsx(p,{sx:{display:"flex",flexDirection:"column",minHeight:267,maxHeight:{xs:"calc(100vh - 140px)",md:"calc(100vh - 160px)"},width:"100%"},children:a.jsx(C,{rows:r||[],columns:n,getRowId:e=>e.name,pageSizeOptions:[5,10,20],initialState:{columns:{columnVisibilityModel:{}},pagination:{paginationModel:{pageSize:10,page:0}}}})})}function K(o){const[c,i]=y(),r=g(),{onSuccess:l,onError:n,...e}={};return x({...e,mutationFn:({name:s,mapping:t})=>c.aliases().upsert(s,t),onMutate:s=>(r.loading(`creating alias "${s.name}"`,{id:"new-alias"}),s),onSuccess:(s,t)=>{r.success("alias created",{id:"new-alias"}),l&&l(s,t,{})},onError:(s,t,d)=>{let S=s.message||"an error occurred";r.error(S,{id:"new-alias"}),n&&n(s,t,d)},onSettled:()=>{m.invalidateQueries({queryKey:u.all(i)})}})}function M(){const[o,c]=y(),{data:i}=f({queryKey:q.names(c),queryFn:async()=>(await o.collections().retrieve()).map(e=>e.name)}),r=K(),l=Q({...k,onSubmit:async({value:n})=>{r.mutate({name:n.aliasName,mapping:{collection_name:n.targetCollection}})}});return a.jsx(p,{component:"form",onSubmit:n=>{n.preventDefault(),n.stopPropagation(),l.handleSubmit()},noValidate:!0,children:a.jsx(_,{form:l,targetOptions:i||[]})})}const N=function(){return a.jsxs(p,{children:[a.jsx(h,{variant:"h3",gutterBottom:!0,children:"Aliases"}),a.jsxs(h,{children:["Aliases are like symlinks that can point to collections."," ",a.jsxs(E,{href:"https://typesense.org/docs/29.0/api/collection-alias.html",target:"_blank",rel:"noopener noreferrer",children:["Read the documentation",a.jsx(D,{fontSize:"inherit",sx:{ml:.5}})]})," ","for information on how to best use aliases."]}),a.jsx(F,{sx:{my:2,p:2},children:a.jsx(M,{})}),a.jsx(p,{children:a.jsx(R,{FallbackComponent:v,children:a.jsx(j.Suspense,{children:a.jsx(I,{})})})})]})};export{N as component};
