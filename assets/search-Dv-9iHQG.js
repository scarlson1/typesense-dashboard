import{aX as v,r as a,j as t,aY as Q,aZ as F,aS as U,a_ as $,z as H,a$ as R,b0 as T,b1 as W,b2 as K,v as G,ac as N,m as z,b3 as w,W as X,a3 as Y,b as Z,b4 as J,b5 as ee,b6 as k,B as C,b7 as se,b8 as te,b9 as re,ba as oe,bb as D,T as b,l as V,a5 as ne,bc as ae,i as ie,_ as I,S as q,bd as ce,be as ue,bf as le,L as pe,O as he,P as de,bg as me}from"./index-DPBpgKE4.js";import{u as xe}from"./useUpsertPreset-C-C4W4rJ.js";import{C as fe}from"./Container-DHHaa6jZ.js";function ye({disabled:s,helperText:e,...o}){var l,c;const{setQuery:r,params:n}=v(),u=a.useCallback(d=>{r(d.target.value)},[]);let p=!!((l=n==null?void 0:n.query_by)!=null&&l.length),h=p?e:'"query_by" param required';return t.jsx(Q,{onChange:u,fullWidth:!0,helperText:h,disabled:s||!((c=n==null?void 0:n.query_by)!=null&&c.length),error:!p,autoComplete:"false",...o})}function ge(){const{isError:s,error:e}=v(),[o,r]=F();a.useEffect(()=>{e&&console.log(e)},[e]);let n=(e==null?void 0:e.message)||"An error occurred. See console for details";return o.error?t.jsx(U,{in:s,children:t.jsx(o.error,{...r.error,children:n})}):null}function be(){const{setPagination:s,data:e,params:o}=v(),[r,n]=F(),u=a.useCallback((h,l)=>{s({page:l})},[s]),p=a.useMemo(()=>e!=null&&e.found&&(o!=null&&o.per_page)?Math.ceil(e.found/o.per_page):1,[o==null?void 0:o.per_page,e==null?void 0:e.found]);return r.pagination?t.jsx(r.pagination,{...n.pagination,count:p,page:(e==null?void 0:e.page)||1,onChange:u}):null}function Se(){const{data:s,isLoading:e,isFetching:o}=v(),[r,n]=F();return r.stats?t.jsxs(r.stats,{...n.stats,children:[`${(s==null?void 0:s.found)??"--"} results found from ${(s==null?void 0:s.out_of)??"--"} docs in ${(s==null?void 0:s.search_time_ms)??"--"}ms`,t.jsx($,{in:e||o,children:t.jsx(H,{size:"0.8125rem",sx:{ml:1}})})]}):null}function Pe(s,e){const[o,r]=a.useState(s);return a.useEffect(()=>{const n=setTimeout(()=>r(s),e||500);return()=>{clearTimeout(n)}},[s,e]),o}const je=()=>{const{defaultSortingField:s,queryByOptions:e,sortByOptions:o,facetByOptions:r,groupByOptions:n}=R();return a.useMemo(()=>({defaultSortingField:s,queryByOptions:e,sortByOptions:o,facetByOptions:r,groupByOptions:n}),[s,e,o,r,n])},_e=s=>{},Ce=()=>{const s=a.useContext(T);if(s===void 0)throw new Error("usePreset must be within a InstantSearch Provider");const{params:e,setPreset:o}=s||{params:{},setPreset:_e};return a.useMemo(()=>[e==null?void 0:e.preset,o],[e==null?void 0:e.preset,o])},ve=s=>{},Ee=()=>{const s=a.useContext(T);if(s===void 0)throw new Error("useSearchParams must be within a InstantSearch Provider");const{params:e,setParams:o}=s||{params:{},setParams:ve},r=a.useCallback(n=>{o(({...u})=>({...u,...n}))},[]);return a.useMemo(()=>[e,r,o],[e,o,r])};var M=W(function(s,e,o,r){K(s,e,o,r)});function Ae({children:s,client:e,clusterId:o,collectionId:r,initialParams:n={per_page:5},debounceMs:u=200,staleTime:p=3e4,pageSizeOptions:h=[5,10,20,50]}){const{queryByOptions:l}=R(),[c,d]=a.useState({query_by:l,...n}),[E,P]=a.useState(""),j=Pe(E,u),{data:g,isLoading:_,isFetching:m,isError:f,error:y,isPlaceholderData:S}=G({queryKey:N.search(o,r,c,j),queryFn:()=>e.collections(r).documents().search({q:j,...c}),staleTime:p});y&&console.log(y);const i=a.useCallback(B=>{d(O=>({...O,preset:B??void 0}))},[]),x=a.useCallback(B=>{d(({...O})=>({...O,...B}))},[]),A=a.useMemo(()=>({data:g,isLoading:_,isFetching:m,isError:f,error:y,isPlaceholderData:S,collectionId:r,params:c,setParams:d,setQuery:P,setPreset:i,setPagination:x,pageSizeOptions:h}),[g,_,m,f,y,S,r,c,d,P,i,x,h]);return t.jsx(T.Provider,{value:A,children:s})}function Be({collectionId:s,...e}){const[o,r]=Ee(),[n,u]=Ce(),[p,h]=z(),l=w(n),{defaultSortingField:c,queryByOptions:d,sortByOptions:E,facetByOptions:P,groupByOptions:j}=je(),{data:g}=X({queryKey:Y.all(h),queryFn:async()=>{const{presets:i}=await p.presets().retrieve();return i}}),_=xe({onSuccess:i=>{u(i.name)}}),m=Z({...ee,defaultValues:{...J,query_by:d,sort_by:c?[c]:[]},...e,onSubmit:async({value:i})=>{try{let{preset:x}=i,A=L(i);await _.mutateAsync({presetId:x,params:{value:A}})}catch(x){console.log(x)}}}),f=k(m.store,i=>i.values.preset),y=w(f);a.useEffect(()=>{if(f!==y){let i=g.find(x=>x.name===f);i!=null&&i.name&&u(i.name)}},[g,f,y]),a.useEffect(()=>{n&&n!==l&&m.setFieldValue("preset",n)},[n,l]);const S=k(m.store,i=>i.values);return a.useEffect(()=>{r(L(S))},[r,S]),t.jsx(C,{component:"form",onSubmit:i=>{i.preventDefault(),i.stopPropagation(),m.handleSubmit()},noValidate:!0,children:t.jsx(se,{form:m,presets:g,queryByOptions:d,sortByOptions:E,facetByOptions:P,groupByOptions:j,submitButtonText:"Save as preset"})})}function Oe(s){let e={};for(const[o,r]of Object.entries(s)){let n=Array.isArray(r)&&!r.length,u=typeof r=="string"&&!r.trim().length;n||u||(e[o]=r),(n||u)&&(e[o]=void 0)}return e}function L(s){let{preset:e,other_params:o,facet_by:r,sort_by:n,query_by:u,group_by:p}=s,h=o.map(c=>({[c.param]:c.value})),l={query_by:u,preset:e||void 0,filter_by:r.join(","),facet_by:r.join(","),sort_by:n.slice(0,3).join(","),group_by:p.join(","),...h[0]||{}};return Oe(l)}const qe=({slots:s,slotProps:e={},children:o})=>{const[r,n]=a.useState(e),u=a.useMemo(()=>({...te,...s||{}}),[s]),p=a.useMemo(()=>M(re,r,(l,c)=>{if(Array.isArray(c))return c}),[r]),h=a.useCallback((l,c=()=>{})=>{n(d=>({...M(d,l,c)}))},[]);return t.jsx(oe.Provider,{value:{slots:u,slotProps:p,updateSlotProps:h},children:o})},ke=function(){const{collectionId:e}=D.useParams(),[o,r]=z();return t.jsxs(t.Fragment,{children:[t.jsx(b,{variant:"h3",gutterBottom:!0,children:e}),t.jsx(V,{from:D.path,hash:"search-params",endIcon:t.jsx(ne,{}),size:"small",children:"Search Parameters"}),t.jsx(ae,{client:o,collectionId:e,clusterId:r,children:t.jsx(Ae,{collectionId:e,client:o,clusterId:r,children:t.jsx(qe,{slots:{stats:b,hits:I,hitWrapper:I},slotProps:{stats:{color:"text.secondary"},hits:{container:!0,spacing:2},hitActions:{sx:{position:"absolute",right:"8px",top:"8px",backgroundColor:n=>ie(n.palette.background.paper,.78)}}},children:t.jsxs(q,{direction:"column",spacing:{xs:.5,sm:1,md:2},children:[t.jsxs(C,{children:[t.jsx(ye,{sx:{my:1}}),t.jsx(Se,{})]}),t.jsx(ge,{}),t.jsx(ce,{}),t.jsxs(q,{direction:{xs:"column-reverse",sm:"row"},sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(V,{to:"/collections/$collectionId/documents/new",params:{collectionId:e},size:"small",startIcon:t.jsx(ue,{fontSize:"small"}),sx:{lineHeight:"18px",my:1},children:"Add Documents"}),t.jsxs(q,{direction:"row",spacing:2,sx:{flex:"1 1 auto",justifyContent:"flex-end",alignItems:"center"},children:[t.jsx(le,{}),t.jsx(be,{})]})]}),t.jsxs(C,{children:[t.jsx(b,{variant:"h5",gutterBottom:!0,children:"Search Parameters"}),t.jsxs(b,{component:"div",gutterBottom:!0,children:["These settings control ranking, relevance and search fine-tuning. Use a preset to save your configuration, and recall in your application."," ",t.jsxs(pe,{href:"https://typesense.org/docs/29.0/api/search.html#search-parameters",target:"_blank",rel:"noopener noreferrer",children:["Docs",t.jsx(he,{fontSize:"inherit",sx:{ml:.5}})]})]})]}),t.jsx(a.Suspense,{children:t.jsx(de,{id:"search-params",children:t.jsx(fe,{maxWidth:"sm",sx:{py:{xs:3,sm:4}},children:t.jsx(Be,{collectionId:e})})})}),t.jsxs(C,{children:[t.jsx(b,{variant:"h6",gutterBottom:!0,children:"Dashboard Display Options"}),t.jsx(b,{variant:"subtitle2",children:"These options control the visual display of the results in the search dashboard above"})]}),t.jsx(me,{})]})})})})]})};export{ke as component};
