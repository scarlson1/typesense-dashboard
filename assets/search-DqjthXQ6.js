import{b0 as v,r as a,j as t,b1 as Q,b2 as F,aY as U,b3 as H,z as W,b4 as R,b5 as T,b6 as $,b7 as K,v as G,ac as N,m as z,b8 as k,W as Y,a3 as J,b as X,b9 as Z,ba as ee,bb as w,B as C,bc as se,bd as te,be as re,bf as oe,bg as D,T as g,l as V,a5 as ne,bh as ae,i as ie,_ as I,S as q,bi as ce,bj as ue,bk as le,L as pe,O as he,P as de,bl as me}from"./index-Baji6FHN.js";import{u as xe}from"./useUpsertPreset-b6uwY8UK.js";import{C as fe}from"./Container-trk_h4NO.js";function ye({disabled:s,helperText:e,...o}){var l,c;const{setQuery:r,params:n}=v(),u=a.useCallback(d=>{r(d.target.value)},[]);let p=!!((l=n==null?void 0:n.query_by)!=null&&l.length),h=p?e:'"query_by" param required';return t.jsx(Q,{onChange:u,fullWidth:!0,helperText:h,disabled:s||!((c=n==null?void 0:n.query_by)!=null&&c.length),error:!p,autoComplete:"false",...o})}function be(){const{isError:s,error:e}=v(),[o,r]=F();a.useEffect(()=>{e&&console.log(e)},[e]);let n=(e==null?void 0:e.message)||"An error occurred. See console for details";return o.error?t.jsx(U,{in:s,children:t.jsx(o.error,{...r.error,children:n})}):null}function ge(){const{setPagination:s,data:e,params:o}=v(),[r,n]=F(),u=a.useCallback((h,l)=>{s({page:l})},[s]),p=a.useMemo(()=>e!=null&&e.found&&(o!=null&&o.per_page)?Math.ceil(e.found/o.per_page):1,[o==null?void 0:o.per_page,e==null?void 0:e.found]);return r.pagination?t.jsx(r.pagination,{...n.pagination,count:p,page:(e==null?void 0:e.page)||1,onChange:u}):null}function Se(){const{data:s,isLoading:e,isFetching:o}=v(),[r,n]=F();return r.stats?t.jsxs(r.stats,{...n.stats,children:[`${(s==null?void 0:s.found)??"--"} results found from ${(s==null?void 0:s.out_of)??"--"} docs in ${(s==null?void 0:s.search_time_ms)??"--"}ms`,t.jsx(H,{in:e||o,children:t.jsx(W,{size:"0.8125rem",sx:{ml:1}})})]}):null}function je(s,e){const[o,r]=a.useState(s);return a.useEffect(()=>{const n=setTimeout(()=>r(s),e||500);return()=>{clearTimeout(n)}},[s,e]),o}const Pe=()=>{const{defaultSortingField:s,queryByOptions:e,sortByOptions:o,facetByOptions:r,groupByOptions:n}=R();return a.useMemo(()=>({defaultSortingField:s,queryByOptions:e,sortByOptions:o,facetByOptions:r,groupByOptions:n}),[s,e,o,r,n])},_e=s=>{},Ce=()=>{const s=a.useContext(T);if(s===void 0)throw new Error("usePreset must be within a InstantSearch Provider");const{params:e,setPreset:o}=s||{params:{},setPreset:_e};return a.useMemo(()=>[e==null?void 0:e.preset,o],[e==null?void 0:e.preset,o])},ve=s=>{},Ee=()=>{const s=a.useContext(T);if(s===void 0)throw new Error("useSearchParams must be within a InstantSearch Provider");const{params:e,setParams:o}=s||{params:{},setParams:ve},r=a.useCallback(n=>{o(({...u})=>({...u,...n}))},[]);return a.useMemo(()=>[e,r,o],[e,o,r])};var M=$(function(s,e,o,r){K(s,e,o,r)});function Ae({children:s,client:e,clusterId:o,collectionId:r,initialParams:n={per_page:5},debounceMs:u=200,staleTime:p=3e4,pageSizeOptions:h=[5,10,20,50]}){const{queryByOptions:l}=R(),[c,d]=a.useState({query_by:l,...n}),[E,j]=a.useState(""),P=je(E,u),{data:b,isLoading:_,isFetching:m,isError:f,error:y,isPlaceholderData:S}=G({queryKey:N.search(o,r,c,P),queryFn:()=>e.collections(r).documents().search({q:P,...c}),staleTime:p});y&&console.log(y);const i=a.useCallback(B=>{d(O=>({...O,preset:B??void 0}))},[]),x=a.useCallback(B=>{d(({...O})=>({...O,...B}))},[]),A=a.useMemo(()=>({data:b,isLoading:_,isFetching:m,isError:f,error:y,isPlaceholderData:S,collectionId:r,params:c,setParams:d,setQuery:j,setPreset:i,setPagination:x,pageSizeOptions:h}),[b,_,m,f,y,S,r,c,d,j,i,x,h]);return t.jsx(T.Provider,{value:A,children:s})}function Be({collectionId:s,...e}){const[o,r]=Ee(),[n,u]=Ce(),[p,h]=z(),l=k(n),{defaultSortingField:c,queryByOptions:d,sortByOptions:E,facetByOptions:j,groupByOptions:P}=Pe(),{data:b}=Y({queryKey:J.all(h),queryFn:async()=>{const{presets:i}=await p.presets().retrieve();return i}}),_=xe({onSuccess:i=>{u(i.name)}}),m=X({...ee,defaultValues:{...Z,query_by:d,sort_by:c?[c]:[]},...e,onSubmit:async({value:i})=>{try{let{preset:x}=i,A=L(i);await _.mutateAsync({presetId:x,params:{value:A}})}catch(x){console.log(x)}}}),f=w(m.store,i=>i.values.preset),y=k(f);a.useEffect(()=>{if(f!==y){let i=b.find(x=>x.name===f);i!=null&&i.name&&u(i.name)}},[b,f,y]),a.useEffect(()=>{n&&n!==l&&m.setFieldValue("preset",n)},[n,l]);const S=w(m.store,i=>i.values);return a.useEffect(()=>{r(L(S))},[r,S]),t.jsx(C,{component:"form",onSubmit:i=>{i.preventDefault(),i.stopPropagation(),m.handleSubmit()},noValidate:!0,children:t.jsx(se,{form:m,presets:b,queryByOptions:d,sortByOptions:E,facetByOptions:j,groupByOptions:P,submitButtonText:"Save as preset"})})}function Oe(s){let e={};for(const[o,r]of Object.entries(s)){let n=Array.isArray(r)&&!r.length,u=typeof r=="string"&&!r.trim().length;n||u||(e[o]=r),(n||u)&&(e[o]=void 0)}return e}function L(s){let{preset:e,other_params:o,facet_by:r,sort_by:n,query_by:u,group_by:p}=s,h=o.map(c=>({[c.param]:c.value})),l={query_by:u,preset:e||void 0,filter_by:r.join(","),facet_by:r.join(","),sort_by:n.slice(0,3).join(","),group_by:p.join(","),...h[0]||{}};return Oe(l)}const qe=({slots:s,slotProps:e={},children:o})=>{const[r,n]=a.useState(e),u=a.useMemo(()=>({...te,...s||{}}),[s]),p=a.useMemo(()=>M(re,r,(l,c)=>{if(Array.isArray(c))return c}),[r]),h=a.useCallback((l,c=()=>{})=>{n(d=>({...M(d,l,c)}))},[]);return t.jsx(oe.Provider,{value:{slots:u,slotProps:p,updateSlotProps:h},children:o})},we=function(){const{collectionId:e}=D.useParams(),[o,r]=z();return t.jsxs(t.Fragment,{children:[t.jsx(g,{variant:"h3",gutterBottom:!0,children:e}),t.jsx(V,{from:D.path,hash:"search-params",endIcon:t.jsx(ne,{}),size:"small",children:"Search Parameters"}),t.jsx(ae,{client:o,collectionId:e,clusterId:r,children:t.jsx(Ae,{collectionId:e,client:o,clusterId:r,children:t.jsx(qe,{slots:{stats:g,hits:I,hitWrapper:I},slotProps:{stats:{color:"text.secondary"},hits:{container:!0,spacing:2},hitActions:{sx:{position:"absolute",right:"8px",top:"8px",backgroundColor:n=>ie(n.palette.background.paper,.78)}}},children:t.jsxs(q,{direction:"column",spacing:{xs:.5,sm:1,md:2},children:[t.jsxs(C,{children:[t.jsx(ye,{sx:{my:1}}),t.jsx(Se,{})]}),t.jsx(be,{}),t.jsx(ce,{}),t.jsxs(q,{direction:{xs:"column-reverse",sm:"row"},sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(V,{to:"/collections/$collectionId/documents/new",params:{collectionId:e},size:"small",startIcon:t.jsx(ue,{fontSize:"small"}),sx:{lineHeight:"18px",my:1},children:"Add Documents"}),t.jsxs(q,{direction:"row",spacing:2,sx:{flex:"1 1 auto",justifyContent:"flex-end",alignItems:"center"},children:[t.jsx(le,{}),t.jsx(ge,{})]})]}),t.jsxs(C,{children:[t.jsx(g,{variant:"h5",gutterBottom:!0,children:"Search Parameters"}),t.jsxs(g,{component:"div",gutterBottom:!0,children:["These settings control ranking, relevance and search fine-tuning. Use a preset to save your configuration, and recall in your application."," ",t.jsxs(pe,{href:"https://typesense.org/docs/29.0/api/search.html#search-parameters",target:"_blank",rel:"noopener noreferrer",children:["Docs",t.jsx(he,{fontSize:"inherit",sx:{ml:.5}})]})]})]}),t.jsx(a.Suspense,{children:t.jsx(de,{id:"search-params",children:t.jsx(fe,{maxWidth:"sm",sx:{py:{xs:3,sm:4}},children:t.jsx(Be,{collectionId:e})})})}),t.jsxs(C,{children:[t.jsx(g,{variant:"h6",gutterBottom:!0,children:"Dashboard Display Options"}),t.jsx(g,{variant:"subtitle2",children:"These options control the visual display of the results in the search dashboard above"})]}),t.jsx(me,{})]})})})})]})};export{we as component};
