import{bp as J,j as e,u as A,m as z,r as c,n as D,q as U,ac as V,bq as $,a as P,t as T,B as j,T as d,L as E,O,br as R,P as W,a_ as F,aG as q,S as M,bs as k,bt as N,bu as Y,bv as m,bw as L,Z as _,bx as X,a5 as H,aY as G}from"./index-Baji6FHN.js";import{u as Q}from"./useSchema-DqyX9U8S.js";const Z=J(e.jsx("path",{d:"M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59 7.11 5.7a.996.996 0 0 0-1.41 0c-.39.39-.39 1.02 0 1.41L10.59 12 5.7 16.89c-.39.39-.39 1.02 0 1.41s1.02.39 1.41 0L12 13.41l4.89 4.89c.39.39 1.02.39 1.41 0s.39-1.02 0-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4"})),ee=s=>{const a=A(),[x,p]=z(),[t,i]=c.useState([]),r=c.useCallback(()=>{i([])},[]);return[D({mutationFn:async({collectionId:n,documents:o,options:h})=>(await x.collections(n).documents().import(o,h)).split(`
`).map(f=>JSON.parse(f)),onMutate:n=>{a.loading("importing documents...",{id:"import-docs"})},onSuccess:(n,o,h)=>{console.log("lines: ",n),i(n);const y=n.reduce((g,b)=>g+b.success*1,0),f=n.reduce((g,b)=>g+!b.success*1,0);a[f?"warn":"success"](`import complete [success: ${y}; failed: ${f}]`,{id:"import-docs"})},onError:(n,o,h)=>{a.error("importing documents...",{id:"import-docs"})},onSettled:(n,o,h,y)=>{U.invalidateQueries({queryKey:V.documents(p,h.collectionId)})}}),t,r]};function se(){const s=$.useParams({select:({collectionId:l})=>l}),a=A(),x=c.useRef(null),[p,t]=c.useState("create"),[i,r]=c.useState(),[u,n]=c.useState([]),{data:o}=Q(s),h=c.useMemo(()=>{let l=o==null?void 0:o.fields.reduce((S,v)=>{let I=ne(v.type);return I?{...S,[v.name]:I}:S},{});return JSON.stringify([l],null,2)},[o==null?void 0:o.fields]),[y,f,C]=ee(),g=c.useCallback(l=>{t(l.target.value)},[]),b=c.useCallback(l=>{r(l.target.value)},[]),K=c.useCallback(l=>{x.current=l},[]),B=c.useCallback(()=>{var v;const l=(v=x.current)==null?void 0:v.getValue();if(u.length)return a.warn("Invalid JSON",{id:"monaco-validation"});if(!l)return a.warn("value required");let S=re(JSON.parse(l));y.mutate({collectionId:s,documents:S,options:{action:p,dirty_values:i,return_id:!0}})},[s,u,p,i]);return e.jsxs(j,{sx:{py:2,borderRadius:1,overflow:"hidden"},children:[e.jsx(F,{height:"50vh",onMount:K,options:q,value:h,onValidate:l=>{n(l)}}),e.jsxs(M,{direction:"row",spacing:2,sx:{my:2,display:"flex",alignItems:"flex-start",flexWrap:"wrap"},useFlexGap:!0,children:[e.jsxs(k,{size:"small",fullWidth:!0,sx:{maxWidth:190},children:[e.jsx(N,{id:"action-select-label",children:"Action Mode"}),e.jsxs(Y,{label:"Action Mode",value:p,onChange:g,labelId:"action-select-label",id:"action-select",size:"small",children:[e.jsx(m,{value:"create",children:"create"}),e.jsx(m,{value:"upsert",children:"upsert"}),e.jsx(m,{value:"update",children:"update"}),e.jsx(m,{value:"emplace",children:"emplace"})]}),e.jsx(L,{component:"div",children:e.jsxs(E,{href:"https://typesense.org/docs/28.0/api/documents.html#index-multiple-documents",target:"_blank",rel:"noopener noreferrer",children:["Action mode insert docs"," ",e.jsx(O,{fontSize:"inherit",sx:{ml:.25}})]})})]}),e.jsxs(k,{size:"small",fullWidth:!0,sx:{maxWidth:190},children:[e.jsx(N,{id:"dirty-values-select-label",children:"Dirty Values Behavior"}),e.jsxs(Y,{label:"Dirty Values Behavior",value:i||"",onChange:b,labelId:"dirty-values-select-label",id:"dirty-values-select",size:"small",children:[e.jsx(m,{value:""}),e.jsx(m,{value:"coerce_or_reject",children:"coerce_or_reject"}),e.jsx(m,{value:"coerce_or_drop",children:"coerce_or_drop"}),e.jsx(m,{value:"drop",children:"drop"}),e.jsx(m,{value:"reject",children:"reject"})]}),e.jsx(L,{component:"div",children:e.jsxs(E,{href:"https://typesense.org/docs/28.0/api/documents.html#dealing-with-dirty-data",target:"_blank",rel:"noopener noreferrer",children:["Dirty values docs"," ",e.jsx(O,{fontSize:"inherit",sx:{ml:.25}})]})})]}),e.jsx(_,{onClick:()=>B(),disabled:!!u.length,variant:"contained",children:"Add"})]}),e.jsx(te,{results:f,clearResults:C})]})}function te({results:s,clearResults:a}){const[x,p]=c.useState(!0),t=c.useCallback(()=>{p(r=>!r)},[]),i=c.useCallback(()=>{a()},[]);return e.jsxs(e.Fragment,{children:[s.length?e.jsxs(M,{direction:"row",spacing:2,sx:{justifyContent:"space-between",alignItems:"center",py:1},children:[e.jsx(_,{size:"small",onClick:t,endIcon:x?e.jsx(X,{fontSize:"small"}):e.jsx(H,{fontSize:"small"}),children:x?"hide results":"show results"}),e.jsx(_,{size:"small",onClick:i,sx:{mb:1},endIcon:e.jsx(Z,{fontSize:"small"}),children:"Clear results"})]}):null,e.jsx(G,{in:x&&!!(s!=null&&s.length),children:s.map(r=>e.jsx(R,{severity:r.success?"success":"error",sx:{maxWidth:760,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:`[ID: ${r.id}] - ${r.error||`import success: ${r.success}`}`},r.id))})]})}function re(s){return s.map(a=>JSON.stringify(a)).join(`
`)}function ne(s){switch(s){case"auto":return null;case"bool":return!1;case"bool[]":return[!0,!1];case"float":return 3.14159;case"float[]":return[3.12159];case"geopoint":return[34.0549,118.2426];case"geopoint[]":return[[34.0549,118.2426],[35.4792,117.2389]];case"geopolygon":return[34.0549,35.4792,118.2426,117.2389];case"image":return"base64 encoded string of an image";case"int32":return 0;case"int32[]":return[0,1];case"int64":return 0;case"int64[]":return[0,1];case"object":return{key:"value"};case"object[]":return[{key:"value"}];case"string":return"string value";case"string*":return"string or string[]";case"string[]":return["string value"];default:return null}}function w({children:s}){return e.jsx(W,{sx:{p:{xs:1.5,sm:2},my:2},children:e.jsx(d,{variant:"body2",color:"textSecondary",component:"pre",sx:{wordWrap:"break-word",overflowWrap:"break-word",wordBreak:"keep-all",whiteSpace:"pre-wrap"},children:s})})}const ce=function(){const{collectionId:a}=$.useParams(),x=P(T,o=>o.credentials),p=P(T,o=>o.currentCredsKey);let t=p?x[p]:null,i=(t==null?void 0:t.protocol)||"[PROTOCOL]",r=(t==null?void 0:t.node)||"[YOUR_NODE]",u=i==="http"?(t==null?void 0:t.port)||"[PORT]":"",n=a||"[COLLECTION_NAME]";return e.jsxs(e.Fragment,{children:[e.jsxs(j,{sx:{py:2},children:[e.jsx(d,{variant:"h3",gutterBottom:!0,children:"Add Documents"}),e.jsx(d,{variant:"h6",color:"primary",gutterBottom:!0,children:"Option 1: Typesense client libraries"}),e.jsxs(d,{component:"div",children:["Use one of Typesense's client libraries to import data into your collection."," ",e.jsxs(E,{href:"https://typesense.org/docs/29.0/api/documents.html#index-a-single-document",target:"_blank",rel:"noopener noreferrer",children:["Read the documentation"," ",e.jsx(O,{fontSize:"inherit",sx:{ml:.25}})]})," ","for more information. Here are some"," ",e.jsxs(E,{href:"https://typesense.org/docs/guide/syncing-data-into-typesense.html#tips-when-importing-data",target:"_blank",rel:"noopener noreferrer",children:["tips ",e.jsx(O,{fontSize:"inherit",sx:{ml:.25}})]})," ","from Typesense to successfully import large volumes of data."]})]}),e.jsxs(j,{sx:{py:2},children:[e.jsx(d,{variant:"h6",color:"primary",gutterBottom:!0,children:"Option 2: Upload a JSONL file via curl"}),e.jsx(d,{children:"Create a file named documents.jsonl with your documents and then run the following commands in your terminal:"}),e.jsxs(w,{children:[e.jsx("code",{children:"export TYPESENSE_API_KEY=YOUR_API_KEY"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("code",{children:'curl -H "X-TYPESENSE-API-KEY: ${TYPESENSE_API_KEY}" \\'}),e.jsx("br",{}),e.jsx("code",{style:{paddingLeft:"24px"},children:"-X POST \\"}),e.jsx("br",{}),e.jsx("code",{style:{paddingLeft:"24px"},children:"-T documents.jsonl \\"}),e.jsx("br",{}),e.jsx("code",{style:{paddingLeft:"24px"},children:`"${i}://${r}${u?`:${u}`:""}/collections/${n}/documents/import?action=create"`})]})]}),e.jsxs(j,{sx:{py:2},children:[e.jsx(d,{variant:"h6",color:"primary",gutterBottom:!0,children:"Option 3: Upload a JSON file"}),e.jsx(d,{children:"Create a file named documents.json with your documents as a JSON array and then run the following commands in your terminal:"}),e.jsxs(w,{children:[e.jsx("code",{children:"# Convert from JSON to JSONL before importing."}),e.jsx("br",{}),e.jsx("code",{children:"# Make sure you have `jq` installed."}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("code",{children:"jq -c '.[]' documents.json > documents.jsonl"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("code",{children:"export TYPESENSE_API_KEY=YOUR_API_KEY"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("code",{children:'curl -H "X-TYPESENSE-API-KEY: ${TYPESENSE_API_KEY}" \\'}),e.jsx("br",{}),e.jsx("code",{style:{paddingLeft:"24px"},children:"-X POST \\"}),e.jsx("br",{}),e.jsx("code",{style:{paddingLeft:"24px"},children:"-T documents.jsonl \\"}),e.jsx("br",{}),e.jsx("code",{style:{paddingLeft:"24px"},children:`"${i}://${r}${u?`:${u}`:""}/collections/${n}/documents/import?action=create"`})]})]}),e.jsxs(j,{sx:{py:2},children:[e.jsx(d,{variant:"h6",color:"primary",gutterBottom:!0,children:"Option 4: Upload a CSV file"}),e.jsx(d,{children:"Create a file named documents.csv with your documents (including a header row) and run the following commands in your terminal"}),e.jsxs(w,{children:[e.jsx("code",{children:"# Convert from JSON to JSONL before importing."}),e.jsx("br",{}),e.jsx("code",{children:"# Make sure you have miller installed: https://github.com/johnkerl/miller"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("code",{children:"mlr --icsv --ojsonl cat documents.csv > documents.jsonl"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("code",{children:"export TYPESENSE_API_KEY=YOUR_API_KEY"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("code",{children:'curl -H "X-TYPESENSE-API-KEY: ${TYPESENSE_API_KEY}" \\'}),e.jsx("br",{}),e.jsx("code",{style:{paddingLeft:"24px"},children:"-X POST \\"}),e.jsx("br",{}),e.jsx("code",{style:{paddingLeft:"24px"},children:"-T documents.jsonl \\"}),e.jsx("br",{}),e.jsx("code",{style:{paddingLeft:"24px"},children:`"${i}://${r}${u?`:${u}`:""}/collections/${n}/documents/import?action=create"`})]})]}),e.jsxs(j,{sx:{py:2},children:[e.jsx(d,{variant:"h6",color:"primary",gutterBottom:!0,children:"Option 5: Use the document editor below"}),e.jsx(d,{children:"Edit the template documents below and click on Add at the bottom of the editor."}),e.jsx(R,{severity:"warning",sx:{my:1,maxWidth:1e3},children:'The prefilled schema is derived from the collection schema. Expect imperfections, especially for nested fields and "auto" schemas.'}),e.jsx(j,{children:e.jsx(se,{})})]})]})};export{ce as component};
