import{j as e,B as c,z as S,T as n,F as W,H as A,I as K,J as I,K as g,Q as G,U,V as O,m as h,W as y,r as m,P as v,S as d,X as f,Y as u,L as C,O as w,E as p,u as P,n as D,Z as E,_ as F,q as H}from"./index-Dl23e-b0.js";import{E as j}from"./ErrorFallback-BY0krYl_.js";function Q({value:t,...s}){return e.jsxs(c,{sx:{position:"relative",display:"inline-flex"},children:[e.jsxs(c,{sx:{position:"relative",display:"grid"},children:[e.jsx(S,{variant:"determinate",value:t,sx:{zIndex:2,gridColumn:1,gridRow:1},...s}),e.jsx(S,{variant:"determinate",value:100,color:"secondary",sx:{opacity:.25,gridColumn:1,gridRow:1,zIndex:1},...s})]}),e.jsx(c,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(n,{variant:"caption",component:"div",sx:{color:"text.secondary"},children:`${t}%`})})]})}var X="[object Symbol]";function R(t){return typeof t=="symbol"||W(t)&&A(t)==X}function Y(t,s){for(var r=-1,i=t==null?0:t.length,a=Array(i);++r<i;)a[r]=s(t[r],r,t);return a}var B=I?I.prototype:void 0,N=B?B.toString:void 0;function z(t){if(typeof t=="string")return t;if(K(t))return Y(t,z)+"";if(R(t))return N?N.call(t):"";var s=t+"";return s=="0"&&1/t==-1/0?"-0":s}var J=/\s/;function Z(t){for(var s=t.length;s--&&J.test(t.charAt(s)););return s}var V=/^\s+/;function ee(t){return t&&t.slice(0,Z(t)+1).replace(V,"")}var T=NaN,te=/^[-+]0x[0-9a-f]+$/i,re=/^0b[01]+$/i,se=/^0o[0-7]+$/i,ne=parseInt;function L(t){if(typeof t=="number")return t;if(R(t))return T;if(g(t)){var s=typeof t.valueOf=="function"?t.valueOf():t;t=g(s)?s+"":s}if(typeof t!="string")return t===0?t:+t;t=ee(t);var r=re.test(t);return r||se.test(t)?ne(t.slice(2),r?2:8):te.test(t)?T:+t}var $=1/0,ie=17976931348623157e292;function oe(t){if(!t)return t===0?t:0;if(t=L(t),t===$||t===-$){var s=t<0?-1:1;return s*ie}return t===t?t:0}function ae(t){var s=oe(t),r=s%1;return s===s?r?s-r:s:0}function k(t){return t==null?"":z(t)}var ce=G.isFinite,le=Math.min;function de(t){var s=Math[t];return function(r,i){if(r=L(r),i=i==null?0:le(ae(i),292),i&&ce(r)){var a=(k(r)+"e").split("e"),o=s(a[0]+"e"+(+a[1]+i));return a=(k(o)+"e").split("e"),+(a[0]+"e"+(+a[1]-i))}return s(r)}}var M=de("round");function q({label:t,labelTotal:s,value:r,...i}){return e.jsxs(c,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(c,{sx:{width:"100%",mr:1},children:e.jsxs(c,{sx:{width:"100%",mr:1,position:"relative"},children:[e.jsx(U,{variant:"determinate",value:r,...i,sx:{height:24,borderRadius:1}}),e.jsx(O,{label:t,variant:"filled",size:"small",color:"secondary",sx:{position:"absolute",left:`${isNaN(r)?50:r}%`,top:"50%",transform:"translate(-50%, -50%)"}})]})}),e.jsx(c,{sx:{minWidth:72},children:e.jsx(n,{variant:"body2",sx:{color:"text.secondary"},children:s})})]})}function xe(){const[t,s]=h(),{data:r}=y({queryKey:[s,"server","health"],queryFn:()=>t.health.retrieve(),staleTime:1e3*5,refetchInterval:1e4}),i=r.ok?"healthy":r.resource_error??"Down";return e.jsx(O,{label:i,color:r.ok?"success":"warning",size:"small"})}function ge(){const[t,s]=h(),{data:r}=y({queryKey:[s,"server","metrics"],queryFn:()=>t.metrics.retrieve(),staleTime:1e3*4,refetchInterval:5e3}),i=m.useMemo(()=>Object.entries(r).filter(([o,l])=>o.startsWith("system_cpu")),[r]),a=Math.round(Number(r.system_memory_used_bytes)/Number(r.system_memory_total_bytes)*100);return e.jsxs(v,{sx:{my:2,p:{xs:2,sm:3,md:4}},children:[e.jsxs(d,{direction:"row",spacing:2,sx:{justifyContent:"space-between"},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Server Metrics"}),e.jsx(xe,{})]}),e.jsx(d,{direction:"row",spacing:{xs:1,sm:1.5,md:2},sx:{py:{xs:1,sm:2,md:2.5},justifyContent:"space-between"},children:i.map(([o,l])=>e.jsxs(d,{direction:"column",spacing:{xs:1,sm:1.5},sx:{alignItems:"center"},children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:f(f(o,"system_"),"_active_percentage")}),e.jsx(Q,{value:Number(l),size:48})]},o))}),e.jsxs(c,{sx:{py:1},children:[e.jsx(n,{variant:"overline",gutterBottom:!0,children:"Memory"}),e.jsx(q,{label:`${u(Number(r.system_memory_used_bytes))}`,labelTotal:`${u(Number(r.system_memory_total_bytes))}`,value:a})]}),e.jsxs(c,{sx:{py:1},children:[e.jsx(n,{variant:"overline",gutterBottom:!0,children:"Disk"}),e.jsx(q,{label:`${u(Number(r.system_disk_used_bytes))}`,labelTotal:`${u(Number(r.system_disk_total_bytes))}`,value:a})]}),e.jsxs(c,{children:[e.jsx(n,{variant:"overline",gutterBottom:!0,children:"System Network"}),e.jsx(n,{children:`Received: ${u(Number(r.system_network_received_bytes))}; Sent: ${u(Number(r.system_network_sent_bytes))}`})]})]})}function ve(){return e.jsx(v,{sx:{my:2,p:{xs:2,sm:3,md:4}},children:e.jsxs(d,{direction:"column",spacing:2,children:[e.jsx(n,{variant:"h6",children:"Server Operations"}),e.jsxs(c,{children:[e.jsx(n,{variant:"subtitle1",gutterBottom:!0,children:"Cache"}),e.jsxs(n,{variant:"body2",sx:{pb:2},children:["Responses of search requests that are sent with use_cache parameter are cached in a LRU cache"," ",e.jsxs(C,{href:"https://typesense.org/docs/29.0/api/cluster-operations.html#clear-cache",target:"_blank",rel:"noopener noreferrer",children:["Docs ",e.jsx(w,{fontSize:"inherit",sx:{ml:.25}})]})]}),e.jsx(p,{FallbackComponent:j,children:e.jsx(me,{})})]}),e.jsxs(c,{children:[e.jsx(n,{variant:"subtitle1",gutterBottom:!0,children:"Compact DB"}),e.jsxs(n,{variant:"body2",sx:{pb:2},children:["Typesense uses RocksDB to store your documents on the disk. Compacting could reduce the size of the database and decrease read latency."," ",e.jsxs(C,{href:"https://typesense.org/docs/29.0/api/cluster-operations.html#compacting-the-on-disk-database",target:"_blank",rel:"noopener noreferrer",children:["Docs ",e.jsx(w,{fontSize:"inherit",sx:{ml:.25}})]})]}),e.jsx(p,{FallbackComponent:j,children:e.jsx(he,{})})]}),e.jsxs(c,{children:[e.jsx(n,{variant:"subtitle1",gutterBottom:!0,children:"Schema Updates in Progress"}),e.jsx(p,{FallbackComponent:j,children:e.jsx(m.Suspense,{children:e.jsx(ue,{})})})]})]})})}function me(){const t=P(),[s,r]=h(),i=D({mutationFn:()=>s.operations.perform("cache/clear"),onMutate:()=>{t.loading("clearing cache...",{id:"cache"})},onSuccess:()=>{t.success("cache cleared",{id:"cache"})},onError:a=>{console.log(a),t.error("error clearing cache",{id:"cache"})},onSettled:()=>{H.invalidateQueries({queryKey:[r]})}});return e.jsx(E,{variant:"contained",onClick:()=>i.mutate(),loading:i.isPending,children:"Clear Cache"})}function he(){const t=P(),[s]=h(),r=D({mutationFn:()=>s.apiCall.post("/operations/db/compact"),onMutate:()=>{t.loading("compacting DB...",{id:"cache"})},onSuccess:()=>{t.success("compact DB operation complete",{id:"cache"})},onError:i=>{console.log(i),t.error("error compacting DB",{id:"cache"})}});return e.jsx(E,{variant:"contained",onClick:()=>r.mutate(),loading:r.isPending,children:"Compact Database"})}function ue(){const[t,s]=h(),{data:r}=y({queryKey:[s,"operations","schemaChanges"],queryFn:()=>t.apiCall.get("/operations/schema_changes"),staleTime:1e3*4,refetchInterval:5e3});return r.length?e.jsx(e.Fragment,{children:r.map(i=>e.jsx(F,{container:!0,columnSpacing:2,rowSpacing:1,children:Object.entries(i).map(([a,o])=>e.jsxs(F,{children:[e.jsx(n,{variant:"body2",color:"text.secondary",children:a}),e.jsx(n,{children:o})]}))}))}):e.jsx(n,{children:"No updates in progress"})}function _e(){return e.jsxs(v,{sx:{my:2,p:{xs:2,sm:3,md:4}},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Typesense"}),e.jsxs(d,{direction:{xs:"column",sm:"row"},spacing:2,useFlexGap:!0,sx:{flexWrap:"wrap"},children:[e.jsx(c,{sx:{flex:"1 1 auto"},children:e.jsx(p,{FallbackComponent:j,children:e.jsx(m.Suspense,{children:e.jsx(pe,{})})})}),e.jsx(c,{sx:{flex:"1 1 auto"},children:e.jsx(p,{FallbackComponent:j,children:e.jsx(m.Suspense,{children:e.jsx(je,{})})})}),e.jsx(c,{sx:{flex:"1 1 auto"},children:e.jsx(p,{FallbackComponent:j,children:e.jsx(m.Suspense,{children:e.jsx(ye,{})})})})]})]})}function pe(){const[t,s]=h(),{data:r}=y({queryKey:[s,"server","metrics"],queryFn:()=>t.metrics.retrieve(),staleTime:1e3*4,refetchInterval:5e3}),i=m.useMemo(()=>Object.entries(r).filter(([o,l])=>o.startsWith("typesense_memory")).map(([o,l])=>{let x=Number(l),b=o.endsWith("bytes")?u(x):x;return[f(o,"typesense_memory_"),b]}),[r]);return e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"subtitle1",gutterBottom:!0,children:"Memory"}),e.jsx(d,{direction:"column",spacing:{xs:1},children:i.map(([a,o])=>e.jsxs(d,{direction:"row",spacing:{xs:1,sm:1.5},children:[e.jsx(n,{variant:"body2",color:"text.secondary",sx:{width:128},children:f(a,"_bytes").split("_").join(" ")}),e.jsx(n,{children:o})]},a))})]})}function je(){const[t,s]=h(),{data:r}=y({queryKey:[s,"server","config","nodes"],queryFn:()=>t.configuration.nodes,staleTime:1e3*4,refetchInterval:5e3});return e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"subtitle1",gutterBottom:!0,children:"Server Config (nodes)"}),e.jsx(d,{direction:"column",spacing:1,children:r.map((i,a)=>e.jsxs(m.Fragment,{children:[e.jsx(n,{variant:"subtitle2",gutterBottom:!0,children:`Node ${a+1}`}),Object.entries(i).map(([o,l])=>e.jsxs(d,{direction:"row",spacing:{xs:1,sm:1.5},children:[e.jsx(n,{variant:"body2",color:"text.secondary",sx:{width:128},children:f(o,"_bytes").split("_").join(" ")}),e.jsx(n,{children:l??"--"})]},`node-${a}-${o}`))]},`node-${a}`))})]})}function ye(){const[t,s]=h(),{data:r}=y({queryKey:[s,"server","stats"],queryFn:()=>t.stats.retrieve(),staleTime:1e3*4,refetchInterval:5e3}),[i,a]=m.useMemo(()=>{const o=Object.entries(r).filter(x=>!g(x[1])),l=Object.entries(r).filter(x=>g(x[1]));return[o,l]},[r]);return e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"subtitle1",gutterBottom:!0,children:"Server Stats"}),e.jsxs(d,{direction:"column",spacing:1,children:[i.map(([o,l],x)=>e.jsxs(d,{direction:"row",spacing:{xs:1,sm:1.5},children:[e.jsx(n,{variant:"body2",color:"text.secondary",sx:{width:160},children:o.split("_").join(" ")}),e.jsx(n,{children:M(l,2)??"--"})]},`stat-${o}-${x}`)),a.map(([o,l],x)=>e.jsxs(m.Fragment,{children:[e.jsx(n,{variant:"overline",children:o.split("_").join(" ")}),Object.entries(l).map(([b,_])=>e.jsxs(d,{direction:"row",spacing:{xs:1,sm:1.5},children:[e.jsx(n,{variant:"body2",color:"text.secondary",sx:{width:160},children:b.split("_").join(" ")}),e.jsx(n,{children:isNaN(_)?"--":M(_,2)})]},`stat-${o}-${x}-${b}`))]},`stat-${o}-${x}`))]})]})}export{ge as S,_e as T,ve as a};
