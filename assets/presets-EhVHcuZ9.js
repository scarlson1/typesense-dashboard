import{b as F,$ as M,a0 as B,a1 as m,j as e,B as A,a2 as I,m as $,W as R,a3 as v,r as j,a4 as y,T as p,a5 as S,E as f,Z as _,u as k,n as D,q as O,L as q,O as L}from"./index-CEjZvgK9.js";import{E as g}from"./ErrorFallback-DA_GSf9C.js";import{u as U}from"./useUpsertPreset-0bq6UrzR.js";import{A as P,a as b,b as T}from"./AccordionSummary-CX6GAxWd.js";function E({defaultValues:r=M,submitButtonText:c="Submit",mutationProps:i}){const n=U(i),s=F({...B,defaultValues:r,onSubmit:async({value:a})=>{try{let o={};a.presetType===m.enum["Single-Collection"]?o=a.searchParameters.map(t=>({[t.name]:t.value}))[0]:a.presetType===m.enum["Multi-Search"]&&(o={searches:a.multiSearchParams.map(d=>Object.assign({},...d.map(t=>({[t.name]:t.value}))))}),await n.mutateAsync({presetId:a.presetId,params:{value:o}}),setTimeout(s.reset,100)}catch(o){console.log(o)}}});return e.jsx(A,{component:"form",onSubmit:a=>{a.preventDefault(),a.stopPropagation(),s.handleSubmit()},noValidate:!0,children:e.jsx(I,{form:s,submitButtonText:c})})}function V(){const[r,c]=$(),{data:i}=R({queryKey:v.all(c),queryFn:async()=>{let{presets:t}=await r.presets().retrieve();return t}}),n=K(),[s,a]=j.useState(null),o=t=>(l,u)=>{a(u?t:null)},d=t=>{n.mutate(t)};return e.jsxs(e.Fragment,{children:[i.map((t,l)=>{let u=Q(t.value);const w={presetId:t.name,presetType:u?m.enum["Multi-Search"]:m.enum["Single-Collection"],searchParameters:u?[y]:Object.entries(t.value).map(([h,x])=>({name:h,value:x})),multiSearchParams:u?t.value.searches.map(h=>Object.entries(h).map(([x,C])=>({name:x,value:C}))):[[y],[y]]};return e.jsxs(P,{expanded:s===`${t.name}-${l}`,onChange:o(`${t.name}-${l}`),children:[e.jsx(b,{expandIcon:e.jsx(S,{}),"aria-controls":`${t.name}-${l}-content`,id:`${t.name}-${l}-header`,children:e.jsx(p,{variant:"h6",children:t.name})}),e.jsx(T,{children:e.jsx(f,{FallbackComponent:g,children:e.jsxs(j.Suspense,{children:[e.jsx(E,{defaultValues:w,submitButtonText:"Update"}),e.jsx(_,{onClick:()=>d(t.name),loading:n.isPending&&n.variables===t.name,disabled:n.isPending,sx:{my:1},color:"error",children:"Delete"})]})})})]},t.name)}),e.jsxs(P,{expanded:s==="new",onChange:o("new"),children:[e.jsx(b,{expandIcon:e.jsx(S,{}),"aria-controls":"new-content",id:"new-header",children:e.jsx(p,{variant:"h6",children:"Add New Preset"})}),e.jsx(T,{children:e.jsx(f,{FallbackComponent:g,children:e.jsx(j.Suspense,{children:e.jsx(E,{submitButtonText:"Add Preset"})})})})]})]})}function K(){const[r,c]=$(),i=k();return D({mutationFn:n=>r.presets(n).delete(),onMutate:n=>{i.success(`deleting ["${n}"]`,{id:`${n}-delete`})},onSuccess:(n,s)=>{i.success(`"${s}" deleted`,{id:`${s}-delete`})},onError:(n,s)=>{i.success(`failed to delete rule ["${s}"]`,{id:`${s}-delete`})},onSettled:()=>{O.invalidateQueries({queryKey:v.all(c)})}})}function Q(r){return r.searches!==void 0}const Z=function(){return e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"h3",gutterBottom:!0,children:"Presets"}),e.jsxs(p,{sx:{maxWidth:760,textAlign:"justify"},gutterBottom:!0,children:["Presets allow you to manage search parameters in Typesense, and reference just the preset name in your application. This way, you can change search parameters without having to make code changes."," ",e.jsxs(q,{href:"https://typesense.org/docs/29.0/api/search.html#presets",target:"_blank",rel:"noopener noreferrer",children:["Read the documentation",e.jsx(L,{fontSize:"inherit"})]})," ","for more information on available options."]}),e.jsx(A,{sx:{py:2,maxWidth:840},children:e.jsx(V,{})})]})};export{Z as component};
