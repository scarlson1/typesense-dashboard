import{a6 as A,m as v,u as D,a7 as K,v as I,a8 as n,n as C,q as r,r as N,j as e,G as w,w as P,x as _,T as y,B as f,y as S,L as W,O as T,a9 as E}from"./index-Baji6FHN.js";const M=[{field:"id",headerName:"ID",type:"number",minWidth:80,flex:.2,sortable:!1,filterable:!1},{field:"description",headerName:"Description",type:"string",minWidth:200,flex:1.5,sortable:!1,filterable:!1},{field:"value_prefix",headerName:"Prefix",type:"string",minWidth:80,flex:.8,sortable:!1,filterable:!1},{field:"collections",headerName:"Collections",type:"string",minWidth:220,flex:1,sortable:!1,filterable:!1,valueFormatter:(s,t)=>t.collections?t.collections.join(", "):""},{field:"actions",headerName:"Actions",type:"string",minWidth:220,flex:1,sortable:!1,filterable:!1,valueFormatter:(s,t)=>t.actions?t.actions.join(", "):""},{field:"autodelete",headerName:"Autodelete",type:"boolean",minWidth:80,flex:.8,sortable:!1,filterable:!1},{field:"expires_at",headerName:"Expiration",type:"date",minWidth:120,flex:.8,sortable:!0,filterable:!0,valueGetter:(s,t)=>t.expires_at?new Date(t.expires_at*1e3):null,renderCell:s=>s.value?A(s.value,"MM/dd/yy"):""}],O=()=>{const[s,t]=v(),u=D(),m=K(),{data:p,isFetching:h,isLoading:x,isError:g,error:k}=I({queryKey:n.all(t),queryFn:()=>s.keys().retrieve()}),d=C({mutationFn:i=>s.keys(i).delete(),onMutate:async i=>{await r.cancelQueries({queryKey:n.all(t)});const l=r.getQueryData(n.all(t)),a=l==null?void 0:l.keys.find(o=>o.id===i);return r.setQueryData(n.all(t),o=>{var c;return{keys:(c=o.keys)==null?void 0:c.filter(b=>b.id!==i)}}),u.loading(`deleting key [${i}]...`,{id:"delete-key"}),{id:i,prevKeyData:a}},onSuccess:(i,l,a)=>{u.success(`API key ${a.id} deleted`,{id:"delete-key"})},onError:(i,l,a)=>{let o=i.message||"failed to delete key";u.error(o,{id:"delete-key"}),a!=null&&a.prevKeyData&&r.setQueryData(n.all(t),c=>({keys:[...c.keys||[],a.prevKeyData]}))},onSettled:()=>{r.invalidateQueries({queryKey:n.all(t)})}}),j=N.useMemo(()=>[...M,{field:"grid-actions",type:"actions",minWidth:50,maxWidth:60,flex:1,getActions:i=>[e.jsx(w,{icon:e.jsx(P,{placement:"top",title:"delete",children:e.jsx(_,{fontSize:"small"})}),onClick:async()=>{try{await m.prompt({variant:"danger",catchOnCancel:!0,title:`Confirm API Key Deletion [ID: ${i.id.toString()}]`,description:`THIS ACTION CANNOT BE UNDONE. Please confirm whether you'd like to delete API Key with prefix ${i.row.value_prefix}`,slotProps:{dialog:{maxWidth:"sm"}}}),d.mutate(i.row.id)}catch{console.log("confirmation exited")}},label:"Delete Collection",disabled:d.isPending})]}],[d.isPending,d.mutate]);return g?e.jsx(y,{children:k.message||"something went wrong"}):e.jsx(f,{sx:{display:"flex",flexDirection:"column",minHeight:267,maxHeight:{xs:"calc(100vh - 140px)",md:"calc(100vh - 160px)"},width:"100%"},children:e.jsx(S,{rows:(p==null?void 0:p.keys)||[],columns:j,loading:x||h,pageSizeOptions:[5,10,20],initialState:{columns:{columnVisibilityModel:{autodelete:!1}},pagination:{paginationModel:{pageSize:10,page:0}}}})})},q=function(){return e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"h3",gutterBottom:!0,children:"API Keys"}),e.jsxs(y,{component:"div",children:["API Keys can be used to control access to the data you index in Typesense. You can restrict access to particular collections or actions using parent API keys. You can also control access to records or even fields using"," ",e.jsxs(W,{href:"https://typesense.org/docs/29.0/api/api-keys.html#generate-scoped-search-key",target:"_blank",rel:"noopener noreferrer",children:["Scoped Search API Keys",e.jsx(T,{fontSize:"inherit",sx:{ml:.5}})]}),"."]}),e.jsx(y,{sx:{py:1},children:"Use the template below to create a new API key."}),e.jsx(f,{sx:{py:2},children:e.jsx(E,{})}),e.jsx(f,{sx:{py:1},children:e.jsx(O,{})})]})};export{q as component};
