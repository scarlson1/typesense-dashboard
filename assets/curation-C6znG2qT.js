import{m as j,W as C,ac as q,r as m,j as o,T as _,a5 as f,E as p,Z as w,aN as S,u as O,n as F,q as k,b as A,aO as D,B,aP as E,aQ as T,L as I,O as $}from"./index-Dl23e-b0.js";import{E as y}from"./ErrorFallback-BY0krYl_.js";import{A as h,a as x,b}from"./AccordionSummary-C1Rg9iCQ.js";const v=({collectionId:s})=>{const[n,u]=j(),{data:i}=C({queryKey:q.curation(u,s),queryFn:async()=>{let{overrides:e}=await n.collections(s).overrides().retrieve();return e}}),[c,d]=m.useState(null),l=e=>(t,r)=>{d(r?e:null)};return o.jsxs(o.Fragment,{children:[i.map(e=>o.jsxs(h,{expanded:c===`${e.id}`,onChange:l(`${e.id}`),children:[o.jsx(x,{expandIcon:o.jsx(f,{}),"aria-controls":`${e.id}-content`,id:`${e.id}-header`,children:o.jsx(_,{variant:"h6",children:e.id})}),o.jsx(b,{children:o.jsx(p,{FallbackComponent:y,children:o.jsxs(m.Suspense,{children:[o.jsx(g,{collectionId:s,submitButtonText:"Update Override",defaultValues:{overrideId:e.id,rule_query_bool:!!e.rule.query,rule_filter_bool:!!e.rule.filter_by,rule_tags_bool:!!e.rule.tags,rule:{query:e.rule.query||"",match:e.rule.match||"exact",filter_by:e.rule.filter_by||"",tags:e.rule.tags?e.rule.tags.join(", "):""},filter_by_bool:!!e.filter_by,filter_by:e.filter_by||"",sort_by_bool:!!e.sort_by,sort_by:e.sort_by,filter_curated_hits:!!e.filter_curated_hits,replace_query_bool:!!e.replace_query,replace_query:e.replace_query||"",remove_match_tokens:!!e.remove_matched_tokens,custom_metadata_bool:!!e.metadata,metadata:e.metadata?JSON.stringify(e.metadata):"",stop_processing:!!e.stop_processing,effective_from_ts_bool:!!e.effective_from_ts,effective_from_ts:e.effective_from_ts?new Date(e.effective_from_ts*1e3):new Date,effective_to_ts_bool:!!e.effective_to_ts,effective_to_ts:e.effective_to_ts?new Date(e.effective_to_ts*1e3):new Date}}),o.jsx(w,{onClick:()=>alert("TODO: delete override"),sx:{my:1},children:"Delete"})]})})})]},e.id)),o.jsxs(h,{expanded:c==="new",onChange:l("new"),children:[o.jsx(x,{expandIcon:o.jsx(f,{}),"aria-controls":"new-content",id:"new-header",children:o.jsx(_,{variant:"h6",children:"Add New Override"})}),o.jsx(b,{children:o.jsx(p,{FallbackComponent:y,children:o.jsx(m.Suspense,{children:o.jsx(g,{collectionId:s,defaultValues:S,submitButtonText:"Add Override"})})})})]})]})};function g({collectionId:s,defaultValues:n,submitButtonText:u}){const i=O(),[c,d]=j(),l=F({mutationFn:({collectionId:t,overrideId:r,params:a})=>c.collections(t).overrides().upsert(r,a),onMutate:t=>{i.loading(`saving curation [${t.overrideId}]`,{id:"save-curation"})},onSuccess:t=>{i.success(`curation saved [${t.id}]`,{id:"save-curation"})},onError:(t,r)=>{let a=t.message||`error saving curation [${r.overrideId}]`;i.error(a,{id:"save-curation"})},onSettled:()=>{k.invalidateQueries({queryKey:q.curation(d,s)})}}),e=A({...D,defaultValues:n,onSubmit:async({value:t})=>{let r={rule:{query:t.rule_query_bool?t.rule.query:void 0,match:t.rule_query_bool?t.rule.match:void 0,filter_by:t.rule_filter_bool?t.rule.match:void 0,tags:t.rule.tags?t.rule.tags.split(", ").map(a=>a.trim()):void 0},filter_by:t.filter_by_bool?t.filter_by:void 0,sort_by:t.sort_by_bool?t.sort_by:void 0,remove_matched_tokens:t.remove_match_tokens,replace_query:t.replace_query_bool?t.replace_query:void 0,filter_curated_hits:t.filter_curated_hits,effective_from_ts:t.effective_from_ts_bool?t.effective_from_ts.getTime()/1e3:void 0,effective_to_ts:t.effective_to_ts_bool?t.effective_to_ts.getTime()/1e3:void 0,stop_processing:t.stop_processing,metadata:t.custom_metadata_bool?JSON.parse(t.metadata):void 0};try{await l.mutateAsync({collectionId:s,overrideId:t.overrideId,params:r}),e.reset()}catch{}}});return o.jsx(B,{component:"form",onSubmit:t=>{t.preventDefault(),t.stopPropagation(),e.handleSubmit()},noValidate:!0,sx:{display:"flex",flexDirection:"column",width:"100%",gap:2},children:o.jsx(E,{form:e,submitButtonText:u})})}const V=function(){const{collectionId:n}=T.useParams();return o.jsxs(o.Fragment,{children:[o.jsx(_,{variant:"h3",gutterBottom:!0,children:"Curation"}),o.jsxs(_,{children:["Curation allows you to pin certain records at particular positions or hide results, for a given search query."," ",o.jsxs(I,{href:"https://typesense.org/docs/29.0/api/curation.html",target:"_blank",rel:"noopener noreferrer",children:["Docs",o.jsx($,{fontSize:"inherit",sx:{ml:.25}})]})]}),o.jsx(B,{sx:{py:{xs:1.5,md:2},maxWidth:800},children:o.jsx(v,{collectionId:n})})]})};export{V as component};
